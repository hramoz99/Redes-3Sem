Criação de usuarios e permissões 

 - gerenciador de servidores > ferramentas > usuarios e computadores > click no dominio > botão direito sob o grupo > novo > usuarios

 - Alocar permissao no usuario
   selecione o usuario > membro de > adicionar > avancado > localizado agora > ok



  Propriedades adicionais : 

        - selecione o usuario > conta > horario de logon (determinar horario de acesso) > fazer logon em (determinar maquina de acesso) > desbloquear conta

        - selecione o usuario > objetos > segurança de exclusao

        - selecione o usuario > sessoes (acesso remoto) 
 
        - selecione o usuario > perfil (script de logon, caminho movel, caminho de armazenamento do usuario)
        

Ver proxyAddress 
Ver replicas de senhas


Criando contas de serviço gerenciado

 <> regras do MSA

       - Não podem ser utilizadas entre várias computadores ou no ambiente de clusters onde o serviço é replicadp entre nós
       - MSA usa uma senha complexa, aleatoria de 240 caracteres e muda-a automaticamente quando atinge a data de expiração de senha do dominio ou do computador (por padrao, é 30 dias)
       - Um cenario comum para usar uma conta de serviço gerenciado pode ser executar um serviço de sql server 2012 ou IIS
       - Existe uma dependencia no servico de distribuição de chave comecando com o windows server 2012 (para suportar contas de servicos gerenciados em grupo, embora agora seja necessario para todas as contas de servicos gerenciados)
       - Exige o windows server 20008 R2 ou superior
       - AD Modulo for windows powerhell
       - Net framework 3.5
       - O Ad ds deve estar configurado no minimo com o nivel funcional do windows server 2008R2



Gerenciado de servidor > abrir o shell 

      comando 'Add KdsRootKey -efectivetine ((get-date).addhours(-10)' (ADIÇÃO DA KDS)
      comando 'New-ADServiceAccount -Name SQL -DNSHostname SRV-02 -PrinciapalsAllowedToRestrieveManagedPassword SRV-02'(criar uma conta)
      comando 'Add-ADCComputerServiceAccount -identitySRV-02 -ServiceAccount SQL (associar a conta ao servidor sql)
      comando 'get-ADSerceAccount -filter *'(verificar se esta funcionando)
      
  

            
03
Boas práticas relacionadas a grupos de segurança
10. Use nomes de grupo de segurança descritivos

Em primeiro lugar, certifique-se de aplicar permissões a recursos com grupos de segurança, não contas individuais, isso torna o gerenciamento de recursos muito mais fácil.Em seguida, não nomeie seus grupos de segurança com um nome genérico como helpdesk ou treinamento de RH.Quando você tem nomes genéricos como este, eles serão usados ​​em todos os tipos de recursos e você perderá todo o controle de segurança.E não há uma maneira fácil de ver para que todos os grupos de segurança têm permissão. Sim, existem ferramentas que você pode executar, mas se você tiver um ambiente de tamanho médio ou grande, isso será uma tarefa enorme.Aqui está um exemplo recente de como isso pode ficar fora de controle (história real).Eu estava trabalhando com um cliente na limpeza de permissões para o Active Directory. Havia vários grupos de segurança que tinham permissões delegadas ao Active Directory.Havia um grupo chamado helpdesk, outro grupo IS Support e outro chamado AD Modify.Eu tinha a impressão de que apenas a equipe do Helpdesk tinha direitos ao Active Directory para redefinir senhas e desbloquear contas.Venha descobrir que esses grupos foram usados ​​para outros recursos, como software de helpdesk, compartilhamento de rede e impressoras. Portanto, incluiu várias equipes de TI.
Depois de remover esses grupos, recebi telefonemas de programadores e analistas de negócios perguntando por que eles não podiam mais redefinir as senhas dos usuários. Por que diabos os programadores estão redefinindo as senhas dos usuários?
Limpei o nome preciso do grupo de segurança que teria evitado que isso acontecesse.
Se você não nomear o grupo de segurança específico, isso pode ser um problema para as permissões para muitas outras coisas.
Aqui estão alguns bons exemplos de como nomear grupos.

Exemplo 1: permitir que o helpdesk redefina senhas
Nome do grupo de segurança: IT-Helpdesk-ActiveDirectory
Como o nome do grupo é preciso, isso ajudaria a evitar que ele fosse usado em outros recursos, como uma impressora ou compartilhamento de rede.

Exemplo 2: permitir direitos de RH para uma pasta compartilhada
Nome do grupo de segurança: HR-Training-Folder-RW Novamente, ele tem um nome muito específico e ajuda a identificar para que deve ser usado.Você pode criar sua própria convenção de nomenclatura,
 basta ser específico com o nome e evitar nomes genéricos de grupos de uma palavra.



04
Boas práticas para a criação de contas de usuário - Parte 1
2. Use pelo menos duas contas (conta normal e conta de administrador)
Você não deve fazer login todos os dias com uma conta de administrador local ou com acesso privilegiado (Admin de Domínio).
Em vez disso, crie duas contas, uma conta normal sem direitos de administrador e uma conta privilegiada que é usada apenas para tarefas administrativas.
MAS
Não coloque sua conta secundária no grupo Admins. Do Domínio, pelo menos permanentemente.
Em vez disso, siga o modelo administrativo de menos privilégios. Basicamente, isso significa que todos os usuários devem fazer logon com uma conta que tenha as permissões mínimas para concluir seu trabalho.
Você pode ler em outros artigos e fóruns para colocar sua conta secundária no grupo Admins. Do Domínio.
Esta não é uma prática recomendada da Microsoft e eu desaconselho. Novamente, temporário está OK, mas precisa ser removido assim que o trabalho seja concluído.
Você deve usar uma conta normal que não seja de administrador para as tarefas do dia a dia, como verificar e-mail, navegar na Internet, sistema de tíquetes e assim por diante. Você só usaria a conta privilegiada quando precisasse realizar tarefas administrativas, como criar um usuário no Active Directory, fazer login em um servidor, adicionar um registro DNS, etc.
Observe esses dois cenários.

Cenário 1 - Equipe de TI com direitos de domínio
Steve faz login em seu computador com uma conta privilegiada, verifica seu e-mail e, inadvertidamente, baixa um vírus. Como Steve é ​​membro do grupo DA, o vírus tem direitos totais sobre seu computador, todos os servidores, todos os arquivos e todo o domínio. Isso pode causar sérios danos e resultar na queda de sistemas críticos.
Agora, considere o mesmo cenário, mas desta vez Steve está conectado com sua conta normal de não administrador.

Cenário 2 - Equipe de TI com direitos regulares
Steve verifica seu e-mail e, inadvertidamente, baixa um vírus. O vírus tem acesso limitado ao computador e nenhum acesso ao domínio ou a outros servidores. Isso causaria danos mínimos e evitaria que o vírus se propagasse pela rede.
Simplesmente usando uma conta normal, você pode aumentar a segurança e evitar causar danos graves.
É muito fácil delegar tarefas administrativas sem conceder direitos de administrador de domínio à equipe. Aqui estão algumas tarefas comuns que podem ser delegadas a uma conta de administrador secundária.
Direitos para usuários e computadores do Active Directory

DNS

DHCP

Direitos de administrador local em servidores

Política de grupo

Troca

Direitos de administrador local em estações de trabalho

Administração Vsphere ou Hyper-v

Algumas organizações usam mais de duas contas e usam uma abordagem em camadas. Isso é definitivamente mais seguro, mas pode ser um inconveniente para alguns.
Conta normal

Conta para administração de servidor

Conta para administração de rede

Conta para administração de estação de trabalho

Ao usar duas contas e implementar o modelo com menos privilégios administrativos, você reduzirá muito os riscos de segurança e evitará situações como o cenário 1.







Habilitar a lixeira do AD


Gerenciador do servidor >  ferramentas Central administrativa do AD > modo de exibição para arvore > expandir o dominio > clicar sobr o dominio > habilitar a lixeira > ok




Montagem do perfil movel 
 
 conectar ao servidor com hyper V > configurações da vm> controlador ECSI > disco rigido > adicionar > novo > avancar > habilitar expansao dinamica > nome do disco > definir tamanho > avancar > concluir 

    | So consegue ser perfil movel se for geração dois

 iniciar vm > botao direito sob iniciar > gerenciador de disco > botao direito sob o disco > deixar on > botao direito sob o disco > iniciar o disco > GPT > botao direito sob disco > novo volume simples > avanca > avanca > avanca > definir rotulo do volume > concluir

 criar pasta dentro do disco (nome do user) > botao direito sob a pasta > propriedades > compartilhamento > compartilhamento avancado > compartilhar a pasta (deixar o $ no nome para ocultar a pasta) > permissoes > remover 'Todos' > adicionar o user > habilitar leitura e alteração > Ok > aplicar

 gerenciador do servidor > Usuario e computadores > usuario (para que a pasta foi criada) >  botao direito > propriedades >  perfil > colar o caminho em caminho do perfil > ok

 | Em caso de problema para login de usuario, ativar o acesso remoto 
                 passo a passo
                       login com qualquer usuario > botao direito sob o iniciar do windows > sistema > area de trabalho remoto > selecionar usuarios > adicionar > senha admin > habilitar acesso remoto   



Pasta Base do usuario 


 criar pasta dentro do disco (nome do user) > botao direito sob a pasta > propriedades > compartilhamento > compartilhamento avancado > compartilhar a pasta (deixar o $ no nome para ocultar a pasta) > permissoes > remover 'Todos' > adicionar o user > habilitar leitura e alteração > Ok > aplicar
  
 gerenciador do servidor > Usuario e computadores > usuario (para que a pasta foi criada) >  botao direito > propriedades >  perfil > colar o caminho em caminho local > ok
 








Administração poer linha de comando 


  Comandos 

   dsadd - adiciona objetos 
   dsget - exibir os objetos 
   dsmod - editar objetos
   dsmove - mover objetos
   dsquery - consulta de objetos com criterios
   dsrm - excluir objetos


Boas práticas para a gestão de senhas do admin local
5. Use a solução de senha de administrador local (LAPS) sempre que possível

O Local Administrator Password Solution (LAPS) está se tornando uma ferramenta popular para lidar com a senha do administrador local em todos os computadores.

LAPS é uma ferramenta da Microsoft que fornece gerenciamento de senha de conta local de computadores associados ao domínio. Ele definirá uma senha exclusiva para cada conta de administrador local e a armazenará no Active Directory para fácil acesso.

Esta é uma das melhores opções gratuitas de mitigação contra ataques de hash e movimento lateral de computador para computador.

É muito comum que as organizações implantem o Windows usando um sistema baseado em imagem. Isso agiliza a implantação de uma configuração padrão em todos os dispositivos.

Mas..

Isso geralmente significa que a conta do administrador local será a mesma em todos os computadores. Como a conta do Administrador local tem direitos totais sobre tudo no computador, basta que um deles seja comprometido, então o hacker pode acessar todos os sistemas.

O LAPS é baseado na infraestrutura do Active Directory, portanto, não há necessidade de instalar servidores adicionais.

A solução usa a extensão do lado do cliente da política de grupo para executar todas as tarefas de gerenciamento nas estações de trabalho. É compatível com Active Directory 2003 SP1 e superior e cliente Vista Service Pack 2 e superior.

Se você precisar usar a conta de administrador local em um computador, recupere a senha do diretório ativo e será exclusiva para aquele único computador.


Importação de usuarios por csv

abrir base de dados > salvar como CSV(separado por virgula) > botao direito sob o arquivo.csv > editar > editar > substituir > substituir ; por , > subtituir tudo > editar > substituir > substituir CN= por "CN= , > substituir tudo > editar > substituir > substituir =house por =lab > substituir tudo > editar > substituir > substituir os caminhos


abrir o windows powersehll > entrar como admin > csvde -i -f .\USERS-IMPORT.txt   



https://systemcenterdudes.com/how-to-install-local-administrator-password-solution-laps/

https://github.com/edupopov/powershell

generatedata.com





