Schema 

  . O schema contém a definição para todos os obejtos do Active Directory. Quando voce cria um novo objeto, as informações fornecidas são validadas com base nas definições contidas no Schema,antes que o objeto seja salvo na base de dados do Active Directory

     Por exemplo, se você preencheu um atributo  do tipo número com valores de texto o active directory nãi irá gravar o objeto no active directory e uma mensagem de erro será exibida



O schema é feito de obejtos classe e atributos. o schema definido por padrao com AD contem um número de classe e atributos, os quais atendem as necessidas da maioria das empresas. Porém o Schema pode ser modificado, 
o Administrador pode modificar as classes existentes ou adicionar novas classes ou atributos. 

Qualquer alteração no Schema deve ser cuidadosamente planejada pois alterações feitas no Schema afetam toda a arvores de dominios. Todos os dominios de uma arvore tem que utilizar o mesmo Schema, ou sej , não podem ser utilizados diferentes
esquemas para os diferentes dominios de uma arvores de dominios


Como os obejtos do AD sao definidos no schema

No schema uma classe de objetos representa uma categoria de objetos do AD como por exemplo contas de usuarios contas de computadores impressoras ou pastas compartilhadaspublicadas no AD e assim por diantes

Na definição de cada classe de objetos do AD esta contida uma lista de atributos que podem ser utilizadas para descrever um obejto da referida classe. Por exemplo, um objeto usuario contem atributos tais como: nome, senha, validade da conta, descrição.

Quando um novo usuario é criado no AD, o usuario torna-se uma nova instancia da classe User do Schema e as informações que voce digita sobre o usuario, torna-se instancias dos atributos definidos na classe user.



Como o Schema é armazenado do Active Directory

 . Cada floresta pode conter um único Schema, ou seja, o Schema tem que ser unico ao longo de todos os dominios de uma floresta. O schema é armazenado nas particoes de schema do AD
 . A partição de Schema do AD bem como a partição de definição do AD são replicadas para todos os DCs da floresta
 . Porém um unico DC controla a estrutura do Schema, Dc este Conhecido como Schema Master. Ou seja somente no DC configurado como Schema Master é que o Administrador poderá fazer alterações 


Cache do Schema

 . cada  DC mantém uma cópia do Schema na memória do servidor para melhorar a perfomance das operações relacionadas ao schema, tais como validação de novos objetos
 . A versao armazenada no cache do servidor é automaticamente atuliazada cada vez que o Schema é atualizado (o que não ocorre como frequencia, na verdade é muito raro fazer alterações)


Quem tem autorização para modificar o Schema:

 . A definição do Schema é protegida por permissoes de acesso. Por padrão, somente membros do grupo Schema Admins (Administradores de esquemas) tem permissão de leitura no Schema
 . Para que um administrador possa alterar o Schema a sua conta deve fazer parte do grupo Schema Admins
 . por padrao somente a conta Administrador do dominio root (em uma árvore de dominio) faz parte do grupo Schema Admins(administradores de esquema)
 . Evidentemente que o aceeso a este grupo deve ser rigorosamente limitado, pois ao adicionar um usuario a este grupo, voce dá ao usuario permissoes para alterar o Schema
 . Alterações indevida (ou má intencionadas) no Schema podem simplesmente paralisar toda a rede, em situações mais graves fazendo que todos os servidores tenham que ser reinstalados, causando possiveis perdas de dados, enfim: um verdadeiro desastre
 . Para alterar o Schema voce deve ter acesso ao servidor que atua como Schema Master. O schema Master normalmente é o primeiro DC instalado no dominio root, embora esta função possa ser delegada a qualquer outro dc do dominio
 . Em todo o diretorio existe um unico servidor no qual existe uma copia do Schema habilitada para alterações. Este servidor é conhecido como Schema Master e normalmente é o primeiro DC instalado no dominio root de uma arvore de dominios 
 . Para localizar o servidor que possui o Schema master digite o comando netdom query fsmo pelo prompt

 comando : netdom query Esmon 

 OBS: este comando nao funciona em windows 2000 e 2003. Para que funcione, instale tools for windows, disponivel no site da microsoft e na pasta tools do cd de instalações

Para adicionar e remover itens é preciso fazer atraves de uma dll

 registrar dll regsvr32 schmmgmt.dll (pronpt de comando)

  windows + r mmc /a > arquivo > adicionar ou remover snap-ins > adicionar Schema do AD > ok 

https://learn.microsoft.com/en-us/windows/win32/adschema/active-directory-schema
